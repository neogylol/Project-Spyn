brick.SetColorMode(2, 2);
global key;
global blueYes;
blueYes=false;

while 1

    
    color = brick.ColorCode(2);
    
    if color == 4
    %start
        brick.MoveMotor('C', -46);
        brick.MoveMotor('A', -50);
    elseif color == 2

 %pickup, switch to keyboard control
disp('blue detected');
hasTouchedBlue = true;
brick.StopAllMotors();
      
InitKeyboard();

while 1 
    pause (0.1);
    switch key
        case 'w'
            disp('w key pressed');
            brick.MoveMotor('C', -10);
            brick.MoveMotor('A', -10);
        case 's'
            disp ('s key pressed');
            brick.MoveMotor('C', 10);
            brick.MoveMotor('A', 10);
        case 'a' 
            disp ('a key pressed');
            brick.MoveMotor('C', 10);
            brick.MoveMotor('A', -10);
        case 'd'
            disp('d key pressed');
            brick.MoveMotor('C', -10);
            brick.MoveMotor('A', 10);
        case 'uparrow'
            disp ('moving motor arm up');
            brick.MoveMotor('B',-5);
        case 'downarrow' 
            disp ('moving motor arm down');
            brick.MoveMotor('B',5);
        case 'q'
            brick.StopAllMotors();
        case 'm'
            disp('returning to code control');
            CloseKeyboard();
            break;
    end
end
    elseif color == 3 && hasTouchedBlue == true
        %dropoff, switch to keyboard control
disp('green detected');
brick.StopAllMotors();
brick.beep;        
InitKeyboard();

while 1 
    pause (0.1);
    switch key
        case 'w'
            disp('w key pressed');
            brick.MoveMotor('C', -15);
            brick.MoveMotor('A', -15);
        case 's'
            disp ('s key pressed');
            brick.MoveMotor('C', 15);
            brick.MoveMotor('A', 15);
        case 'a' 
            disp ('a key pressed');
            brick.MoveMotor('C', 15);
            brick.MoveMotor('A', -15);
        case 'd'
            disp('d key pressed');
            brick.MoveMotor('C', -15);
            brick.MoveMotor('A', 15);
        case 'uparrow'
            disp ('moving motor arm up');
            brick.MoveMotor('B',-5);
        case 'downarrow' 
            disp ('moving motor arm down');
            brick.MoveMotor('B',5);
        case 'q'
            brick.StopAllMotors();
        case 'm'
            disp('returning to code control');
            CloseKeyboard();
            break;
    end
end
       
    elseif  color == 5
        brick.StopAllMotors('Coast');
        pause(1);
        brick.MoveMotor('C', -46);
        brick.MoveMotor('A', -50);
    end 
    
    % read data from touch sensor

    touch = brick.TouchPressed(4);

    if touch == 0
        disp("Moving forward");
        brick.MoveMotor('C', -46);
        brick.MoveMotor('A', -50);
        
                % get data from ultrasonic sensor

            dR = brick.UltrasonicDist(3);

            % display the distance
            disp("Distance Right: " + dR);

            if dR > 14 && dR < 21
                % if distance is more than 14 cm and less than 21, move forward
                disp("Moving forward");
                brick.MoveMotor('C', -46);
                brick.MoveMotor('A', -50);
                
            elseif dR < 14
                % if distance is less than 14 cm
                pause(.15);
                disp("Turning left");
                  brick.MoveMotor('C', 30);
                  brick.MoveMotor('A', -30);
                 
            elseif dR > 21
                pause(.15);
                % if distance is more than 21 cm
                disp("Turning right");
                  brick.MoveMotor('C', -30);
                  brick.MoveMotor('A', 30);
              
            end
        else
        % stop all motors before turning
        brick.StopAllMotors();
        pause(1);
        disp("Turning left");
        % turn left 90 degrees
        brick.MoveMotor('C', 30);
        brick.MoveMotor('A', -30);
        pause(1);
    end

    
   
end
